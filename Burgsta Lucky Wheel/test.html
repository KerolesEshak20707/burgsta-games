<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù„Ø¹Ø¨Ø© Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</title>
    <style>
        body {
            font-family: 'Cairo', Arial, sans-serif;
            background: #f5f1e6;
            margin: 20px;
            direction: rtl;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #c49b41;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
        }
        button:hover {
            background: #d4af37;
        }
        .status {
            background: #e8dcc0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error {
            background: #ffebee;
            color: #c62828;
        }
        .success {
            background: #e8f5e8;
            color: #2e7d32;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù„Ø¹Ø¨Ø© Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ - Burgsta</h1>
        
        <div class="status" id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        
        <h2>Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h2>
        <button onclick="testSettings()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        <button onclick="testStorage()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ®Ø²ÙŠÙ†</button>
        <button onclick="testGameManager()">Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¯ÙŠØ± Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        <button onclick="resetGame()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        <button onclick="addTestPrizes()">Ø¥Ø¶Ø§ÙØ© Ø¬ÙˆØ§Ø¦Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        <button onclick="showStats()">Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
        <button onclick="exportData()">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        
        <h2>Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©:</h2>
        <pre id="gameState">Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ù‡Ù†Ø§...</pre>
        
        <h2>Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:</h2>
        <div id="log"></div>
    </div>

    <script src="helpers.js"></script>
    <script>
        let gameManager;
        
        // ØªØ­Ù…ÙŠÙ„ Ù…Ø¯ÙŠØ± Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
        class TestGameManager {
            constructor() {
                this.settings = null;
                this.dailyLimits = {};
                this.colors = {
                    primary: '#c49b41',
                    secondary: '#f5f1e6',
                    dark: '#8b6914',
                    light: '#fff9e6',
                    text: '#5d4e37',
                    accent: '#d4af37'
                };
            }

            async loadSettings() {
                try {
                    const response = await fetch('./settings.json');
                    this.settings = await response.json();
                    this.initializeDailyLimits();
                    return true;
                } catch (error) {
                    log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: ' + error.message, 'error');
                    return false;
                }
            }

            initializeDailyLimits() {
                const today = new Date().toDateString();
                const savedDate = localStorage.getItem('burgsta_date');
                
                if (savedDate !== today) {
                    localStorage.setItem('burgsta_date', today);
                    localStorage.removeItem('burgsta_daily_limits');
                }

                const savedLimits = localStorage.getItem('burgsta_daily_limits');
                if (savedLimits) {
                    this.dailyLimits = JSON.parse(savedLimits);
                } else {
                    this.dailyLimits = { ...this.settings.daily_limits };
                    this.saveDailyLimits();
                }
            }

            saveDailyLimits() {
                localStorage.setItem('burgsta_daily_limits', JSON.stringify(this.dailyLimits));
            }

            getAvailablePrizes() {
                if (!this.dailyLimits || Object.keys(this.dailyLimits).length === 0) {
                    return [];
                }
                return Object.keys(this.dailyLimits).filter(prize => this.dailyLimits[prize] > 0);
            }
        }
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString('ar-SA');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            logDiv.innerHTML += `<div class="status ${className}">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type === 'error' ? 'error' : type === 'success' ? 'success' : ''}`;
            statusDiv.textContent = message;
        }
        
        function updateGameState() {
            const state = {
                date: BurgstaHelpers.Storage.get('burgsta_date'),
                limits: BurgstaHelpers.Storage.get('burgsta_daily_limits'),
                spins: BurgstaHelpers.Storage.get('burgsta_daily_spins'),
                wins: BurgstaHelpers.Storage.get('burgsta_daily_wins'),
                support: BurgstaHelpers.Performance.checkSupport()
            };
            
            document.getElementById('gameState').textContent = JSON.stringify(state, null, 2);
        }
        
        async function testSettings() {
            log('Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...');
            
            try {
                const response = await fetch('./settings.json');
                const settings = await response.json();
                
                if (settings.daily_limits && settings.probabilities) {
                    log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ§Øª
                    const totalProb = Object.values(settings.probabilities).reduce((sum, prob) => sum + prob, 0);
                    if (totalProb === 100) {
                        log('âœ… Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ§Øª ØµØ­ÙŠØ­ (100%)', 'success');
                    } else {
                        log(`âš ï¸ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ§Øª: ${totalProb}% (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 100%)`, 'error');
                    }
                } else {
                    log('âŒ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                }
            } catch (error) {
                log('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: ' + error.message, 'error');
            }
            
            updateGameState();
        }
        
        function testStorage() {
            log('Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ®Ø²ÙŠÙ†...');
            
            const testKey = 'burgsta_test';
            const testValue = { test: true, timestamp: Date.now() };
            
            if (BurgstaHelpers.Storage.set(testKey, testValue)) {
                log('âœ… ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† ØªØ¹Ù…Ù„', 'success');
                
                const retrieved = BurgstaHelpers.Storage.get(testKey);
                if (retrieved && retrieved.test === true) {
                    log('âœ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† ØªØ¹Ù…Ù„', 'success');
                    BurgstaHelpers.Storage.remove(testKey);
                    log('âœ… Ø­Ø°Ù Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙŠØ¹Ù…Ù„', 'success');
                } else {
                    log('âŒ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù„Ø§ ØªØ¹Ù…Ù„', 'error');
                }
            } else {
                log('âŒ ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù„Ø§ ØªØ¹Ù…Ù„', 'error');
            }
            
            updateGameState();
        }
        
        async function testGameManager() {
            log('Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¯ÙŠØ± Ø§Ù„Ù„Ø¹Ø¨Ø©...');
            
            gameManager = new TestGameManager();
            const success = await gameManager.loadSettings();
            
            if (success) {
                log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ø¯ÙŠØ± Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                const availablePrizes = gameManager.getAvailablePrizes();
                log(`ğŸ“Š Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² Ø§Ù„Ù…ØªØ§Ø­Ø©: ${availablePrizes.length}`, 'info');
                availablePrizes.forEach(prize => {
                    const count = gameManager.dailyLimits[prize];
                    log(`  - ${prize}: ${count} Ù…ØªØ¨Ù‚ÙŠØ©`);
                });
            } else {
                log('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¯ÙŠØ± Ø§Ù„Ù„Ø¹Ø¨Ø©', 'error');
            }
            
            updateGameState();
        }
        
        function resetGame() {
            log('Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©...');
            BurgstaHelpers.Debug.resetGame();
        }
        
        function addTestPrizes() {
            log('Ø¥Ø¶Ø§ÙØ© Ø¬ÙˆØ§Ø¦Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±...');
            
            const prizes = ['ÙˆØ¬Ø¨Ø© Ù…Ø¬Ø§Ù†ÙŠØ© ğŸ”', 'Ø®ØµÙ… 50% ğŸ’¸', 'Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ ğŸ¥¤', 'Ø®ØµÙ… 10% ğŸ’°'];
            prizes.forEach(prize => {
                BurgstaHelpers.Debug.addPrizes(prize, 5);
            });
            
            log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© 5 Ø¬ÙˆØ§Ø¦Ø² Ù„ÙƒÙ„ Ù†ÙˆØ¹', 'success');
            updateGameState();
        }
        
        function showStats() {
            log('Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...');
            
            const stats = BurgstaHelpers.Analytics.getAllTimeStats();
            log(`ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙˆØ±Ø§Øª: ${stats.totalSpins}`);
            log(`ğŸ† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²: ${stats.totalWins}`);
            log(`ğŸ“ˆ Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙÙˆØ²: ${stats.winRate}%`);
            
            Object.entries(stats.prizeBreakdown).forEach(([prize, count]) => {
                log(`  - ${prize}: ${count} Ù…Ø±Ø©`);
            });
        }
        
        function exportData() {
            log('ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
            BurgstaHelpers.Debug.exportData();
            log('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ…Ù„Ù JSON', 'success');
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
        window.addEventListener('DOMContentLoaded', async () => {
            updateStatus('Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©...');
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ø¹Ù…
            const support = BurgstaHelpers.Performance.checkSupport();
            log('ğŸ” ÙØ­Øµ Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØµÙØ­:');
            Object.entries(support).forEach(([feature, supported]) => {
                log(`  - ${feature}: ${supported ? 'âœ…' : 'âŒ'}`, supported ? 'success' : 'error');
            });
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            await testSettings();
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ®Ø²ÙŠÙ†
            testStorage();
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¯ÙŠØ± Ø§Ù„Ù„Ø¹Ø¨Ø©
            await testGameManager();
            
            updateStatus('Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©', 'success');
            updateGameState();
        });
    </script>
</body>
</html>